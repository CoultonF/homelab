apiVersion: v1
kind: ConfigMap
metadata:
  name: restic-config
  namespace: backup
data:
  # B2 S3-compatible endpoint — update region to match your bucket
  RESTIC_REPOSITORY: "s3:https://s3.us-west-004.backblazeb2.com/homelab-talos-backup"
  BACKUP_SOURCE: "/host-var"

  # Retention policy
  KEEP_LAST: "7"
  KEEP_DAILY: "7"
  KEEP_WEEKLY: "4"
  KEEP_MONTHLY: "6"

  # Exclude patterns for restic backup
  excludes.txt: |
    # Talos runtime — ephemeral, recreated on boot
    /host-var/run/**

    # containerd layer cache — huge and fully rebuildable
    /host-var/lib/containerd/io.containerd.snapshotter.v1.overlayfs/**
    /host-var/lib/containerd/io.containerd.content.v1.content/**
    /host-var/lib/containerd/io.containerd.metadata.v1.bolt/**

    # Kubelet projected/secret volumes — regenerated by the API server
    /host-var/lib/kubelet/pods/*/volumes/kubernetes.io~projected/**
    /host-var/lib/kubelet/pods/*/volumes/kubernetes.io~secret/**

    # Temp and swap files
    *.tmp
    *.swap
