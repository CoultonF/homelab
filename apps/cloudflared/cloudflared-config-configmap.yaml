apiVersion: v1
kind: ConfigMap
metadata:
  name: cloudflared-config
  namespace: cloudflared
data:
  config.yaml: |
    tunnel: baefdc8a-09d0-4432-8998-394b54cda77d
    credentials-file: /etc/cloudflared/creds/credentials.json
    metrics: 0.0.0.0:2000
    no-autoupdate: true
    ingress:
      # Route test.coultonf.com to nginx example
      - hostname: test.coultonf.com
        service: http://nginx-example.default.svc.cluster.local:80

      # Route mealie.coultonf.com to Mealie
      - hostname: mealie.coultonf.com
        service: http://mealie.mealie.svc.cluster.local:9000

      # Route photos.coultonf.com to Immich
      - hostname: photos.coultonf.com
        service: http://immich-server.immich.svc.cluster.local:3001

      # Route photos-auth.coultonf.com to icloudpd web UI
      - hostname: photos-auth.coultonf.com
        service: http://icloudpd-webui.photo-sync.svc.cluster.local:8080

      # Example: Route api.example.com to an API service
      - hostname: api.example.com
        service: http://api-service.default.svc.cluster.local:8080

      # Example: Route dashboard.example.com to Kubernetes dashboard
      - hostname: dashboard.example.com
        service: https://kubernetes-dashboard.kubernetes-dashboard.svc.cluster.local:443
        originRequest:
          noTLSVerify: true

      # Example: Route grafana.example.com with path-based routing
      - hostname: grafana.example.com
        service: http://grafana.monitoring.svc.cluster.local:3000

      # Example: WebSocket service
      - hostname: ws.example.com
        service: ws://websocket-service.default.svc.cluster.local:8080

      # Example: TCP service (like SSH)
      - hostname: ssh.example.com
        service: tcp://ssh-service.default.svc.cluster.local:22

      # Catch-all rule (must be last)
      - service: http_status:404
